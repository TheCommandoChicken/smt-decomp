#include "common.h"
#include "lib/sys/types.h"
#include "lib/libgte.h"
#include "lib/libgpu.h"
#include "lib/libgs.h"
#include "dungeon.h"
#include "object.h"

struct unk_data_22_2 {
	POLY_FT4 p[2];
	u8 buffer;
};

enum map_marker_type {
	MARKER_NONE,
	MARKER_NORMAL,
	MARKER_EVENT,
	MARKER_PRIZE,
	MARKER_BOSS,
	MARKER_OTHER,
	// Out of bounds indexing.
	MARKER_SHOP,
	MARKER_TERMINAL
};

struct packed_map_marker {
	u16 x:7;
	u16 y:6;
	enum map_marker_type type:3;
};

struct map_marker {
	u8 x;
	u8 y;
	enum map_marker_type type;
};

struct unk_data_110 {
	s32 unk0[150];
	s16 unk258;
	s16 unk25A;
	s16 unk25C;
	s16 unk25E;
};

struct unk_data_113 {
	struct object * unk0;
	u8 unk4;
	u32 unk8;
	u32 unkC;
	struct object * unk10;
	struct object * unk14;
	struct object * unk18;
	struct object * unk1C;
	struct object * unk20;
	struct object * unk24;
	struct object * unk28;
	struct object * unk2C;
	struct object * unk30;
	struct unk_data_120 {
		SPRT_8 unk0;
		DR_MODE unk10;
	} unk34[2];
	RECT unk6C;
	struct unk_data_121 {
		SPRT_8 unk0[35];
		SPRT_8 unk230[8];
		DR_MODE unk2B0;
		DR_MODE unk2BC;
	} unk74[2];
	RECT unk604[35];
	RECT unk71C[8];
	s16 unk75C;
	s16 unk75E;
	struct unk_data_118 {
		SPRT_16 s0[4];
		SPRT s1;
		POLY_G4 p;
		DR_MODE d[2];
	} unk760[2];
	RECT unk880[5];
	struct unk_data_125 {
		SPRT_8 s[5];
		DR_MODE d;
	} unk8A8[2];
	RECT unk960[5];
	s32 unk[161];
	u8 unkC0C;
	u8 unkC0D;
	s16 unkC0E;
	s16 unkC10;
	s16 unkC12;
	s16 unkC14;
	s16 unkC16;
	s16 unkC18;
	s16 unkC1A;
	s32 unkC1C[472];
	u16 (*unk137C[8])[];
	u32 unk139C;
	s16 unk13A0;
	s16 unk13A2;
	s32 unk13A4[157];
	s16 unk1618;
	s16 unk161A;
	s16 unk161C;
	s16 unk161E;
	s16 unk1620;
	u8 marker_selection[5];
	u8 markers[8][3];
};

struct unk_data_114 {
	SPRT_8 s[12];
	DR_MODE d;
};

struct unk_data_116 {
	struct unk_data_114 unk0[2];
	struct object * unk198;
	s16 unk19C;
	s16 unk19E;
	s32 unk1A0;
	s16 unk1A4;
	s32 unk1A8;
	u8 unk1AC;
	u8 unk1AD;
	s16 unk1AE;
};

struct unk_data_115 {
	s32 unk0[8];
	u8 (* marker_selection_ptr)[5];
	s16 selected_marker;
	s16 marker;
	s16 unk28;
	s16 unk2A;
	s16 unk2C;
	s16 unk2E;
	s32 unk30;
	s16 unk34;
	s32 unk38;
	s16 unk3C;
	s16 unk3E;
	s16 unk40;
	s16 unk42;
};

struct unk_data_119 {
	s16 unk0;
	s16 unk2;
	s16 unk4;
	s16 unk6;
	s16 unk8;
	u8 unkA;
};

struct unk_data_122 {
	u8 unk0;
	u8 unk1;
	u16 unk2;
	s16 unk4;
	s16 unk6;
	u16 unk8;
	s16 unkA;
	s16 unkC;
	s16 unkE;
	struct unk_data_22_2 unk10;
	struct unk_data_123 {
		s16 unk0;
		s16 unk2;
		s16 unk4;
		s16 unk6;
		s16 unk8;
		s16 unkA;
		s16 unkC;
		s16 unkE;
		s16 unk10;
		s16 unk12;
		s16 unk14;
		s16 unk16;
	} unk64;
	s16 unk7C;
	s16 unk7E;
	s16 unk80;
	s16 unk82;
	s16 unk84;
	s16 unk86;
	s16 unk88;
	s16 unk8A;
	s16 unk8C;
	s16 unk8E;
	s16 unk90;
	s16 unk92;
	s16 unk94;
	s16 unk96;
};

struct unk_data_124 {
	s16 unk0;
	struct object * unk4;
	struct object * unk8;
	s16 x0;
	s16 y0;
	s16 x1;
	s16 y1;
	s16 unk14;
	s16 unk16;
	s16 unk18;
	s16 unk1A;
	s32 unk1C;
	u8 buffer;
};

struct map_marker_reticle {
	LINE_F2 vert[2];
	LINE_F2 horz[2];
	s16 buffer;
	s16 x;
	s16 y;
	u8 unk46;
	u8 r;
	u8 g;
	u8 b;
	s16 ot_index;
	s32 active;
};

struct unk_data_127 {
	struct object * unk0;
	s16 unk4;
	s16 unk6;
	s16 unk8;
	s16 unkA;
	u16 * unkC;
	s16 unk10;
	s16 unk12;
	s32 unk14;
	s16 unk18;
};

const s16 D_80010BFC[5][2] = {
	{8, 0xC0},
	{8, 0xC8},
	{8, 0xD0},
	{8, 0xD8},
	{8, 0xE0}};
const s16 D_80010C10[12][2] = {
    {0, 0xC8},
    {0x30, 0xE0},
    {0x30, 0xE8},
    {0, 0xF0},
    {0x30, 0xF8},
    {0x30, 0xF0},
    {0, 0xF8},
    {0, 0xD0},
    {0, 0xD8},
    {0, 0xE0},
    {0, 0xE8},
    {0x20, 0xE0}
};
u8 D_800A0CDC[134][2];
u16 (*DungeonMapMarkerLocationNames[134])[] = {
	&(u16[4]){0x239, 0x263},																				   // "自宅"
	&(u16[4]){0x277, 0x19, 0x279},																			   // "隣の家"
	&(u16[6]){0x53, 0x52, 0x5B, 0x52, 0x90},																   // "アーケード"
	&(u16[10]){0x54, 0x6B, 0x82, 0x5E, 0x79, 0x218, 0x24C, 0x19, 0x248},									   // "イノガシラ公園の館"
	&(u16[6]){0x273, 0x274, 0xA5, 0xB4},																	   // "病院1F"
	&(u16[6]){0x273, 0x274, 0xA6, 0xB4},																	   // "病院2F"
	&(u16[8]){0x56, 0x5C, 0x52, 0x92, 0x7B, 0xA5, 0xB4},													   // "エコービル1F"
	&(u16[8]){0x56, 0x5C, 0x52, 0x92, 0x7B, 0xA6, 0xB4},													   // "エコービル2F"
	&(u16[8]){0x56, 0x5C, 0x52, 0x92, 0x7B, 0xA7, 0xB4},													   // "エコービル3F"
	&(u16[8]){0x56, 0x5C, 0x52, 0x92, 0x7B, 0xA8, 0xB4},													   // "エコービル4F"
	&(u16[8]){0x56, 0x5C, 0x52, 0x92, 0x7B, 0xA9, 0xB4},													   // "エコービル5F"
	&(u16[6]){0x258, 0x259, 0x25A, 0xA5, 0xB4},																   // "研究所1F"
	&(u16[6]){0x258, 0x259, 0x25A, 0xA6, 0xB4},																   // "研究所2F"
	&(u16[8]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x256, 0x255},													   // "シンジュク東口"
	&(u16[8]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x253, 0x255},													   // "シンジュク西口"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0xFD, 0x1F8, 0x247},											   // "シンジュク地下街"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0xFD, 0x1F8, 0x108},											   // "シンジュク地下道"
	&(u16[8]){0x8F, 0x9C, 0x5F, 0x5C, 0xFD, 0x1F8},															   // "ディスコ地下"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x92, 0x7B, 0xA5, 0xB4},										   // "シンジュク1F"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x92, 0x7B, 0xA6, 0xB4},										   // "シンジュク2F"
	&(u16[4]){0x141, 0x24F},																				   // "都庁"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x253, 0x92, 0x7B},											   // "シンジュク西ビル"
	&(u16[10]){0x54, 0x63, 0x82, 0x76, 0x260, 0x261, 0xFD, 0xA5, 0xB4},										   // "イチガヤ駐屯地1F"
	&(u16[10]){0x54, 0x63, 0x82, 0x76, 0x260, 0x261, 0xFD, 0xA6, 0xB4},										   // "イチガヤ駐屯地2F"
	&(u16[10]){0x54, 0x63, 0x82, 0x76, 0x260, 0x261, 0xFD, 0xA7, 0xB4},										   // "イチガヤ駐屯地3F"
	&(u16[12]){0x54, 0x63, 0x82, 0x76, 0x260, 0x261, 0xFD, 0xB0, 0xA5, 0xB4},								   // "イチガヤ駐屯地B1F"
	&(u16[12]){0x53, 0x74, 0x7A, 0x58, 0x1F2, 0xF2, 0x248, 0xFD, 0x1F8, 0x108},								   // "アメリカ大使館地下道"
	&(u16[10]){0x53, 0x74, 0x7A, 0x58, 0x1F2, 0xF2, 0x248, 0xA5, 0xB4},										   // "アメリカ大使館1F"
	&(u16[10]){0x53, 0x74, 0x7A, 0x58, 0x1F2, 0xF2, 0x248, 0xA6, 0xB4},										   // "アメリカ大使館2F"
	&(u16[6]){0x1C, 0x250, 0xEE, 0x251},																	   // "金剛神界"
	&(u16[8]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x256, 0x255},													   // "シンジュク東口"
	&(u16[8]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0x253, 0x255},													   // "シンジュク西口"
	&(u16[10]){0x5E, 0x80, 0x88, 0xA1, 0x5A, 0xFD, 0x1F8, 0x247},											   // "シンジュク地下街"
	&(u16[8]){0x5E, 0x93, 0x76, 0x92, 0x7B, 0xA5, 0xB4},													   // "シブヤビル1F"
	&(u16[8]){0x5E, 0x93, 0x76, 0x92, 0x7B, 0xA6, 0xB4},													   // "シブヤビル2F"
	&(u16[8]){0x1FF, 0xEF, 0x19, 0xF8, 0xEE, 0x266, 0x251},													   // "少女の精神世界"
	&(u16[10]){0x7D, 0xA3, 0x9A, 0x80, 0x83, 0x27A, 0x27B, 0x180, 0x27C},									   // "ロッポンギ連絡通路"
	&(u16[8]){0x7D, 0xA3, 0x9A, 0x80, 0x83, 0xA5, 0xB4},													   // "ロッポンギ1F"
	&(u16[8]){0x7D, 0xA3, 0x9A, 0x80, 0x83, 0xA6, 0xB4},													   // "ロッポンギ2F"
	&(u16[8]){0x7D, 0xA3, 0x9A, 0x80, 0x83, 0xA7, 0xB4},													   // "ロッポンギ3F"
	&(u16[10]){0x7D, 0xA3, 0x9A, 0x80, 0x83, 0xB0, 0xA5, 0xB4},												   // "ロッポンギB1F"
	&(u16[8]){0x1F2, 0xFD, 0x1F8, 0x108, 0xB0, 0xA7, 0xB4},													   // "大地下道B3F"
	&(u16[8]){0x1F2, 0xFD, 0x1F8, 0x108, 0xB0, 0xA6, 0xB4},													   // "大地下道B2F"
	&(u16[16]){0x1F2, 0xFD, 0x1F8, 0x108, 0x7D, 0xA3, 0x9A, 0x80, 0x83, 0x212, 0x28, 0x255, 0xB0, 0xA5, 0xB4}, // "大地下道ロッポンギ入り口B1F"
	&(u16[16]){0x1F2, 0xFD, 0x1F8, 0x108, 0x7D, 0xA3, 0x9A, 0x80, 0x83, 0x212, 0x28, 0x255, 0xB0, 0xA6, 0xB4}, // "大地下道ロッポンギ入り口B2F"
	&(u16[16]){0x1F2, 0xFD, 0x1F8, 0x108, 0x54, 0x5B, 0x93, 0x5A, 0x7D, 0x212, 0x28, 0x255, 0xB0, 0xA5, 0xB4}, // "大地下道イケブクロ入り口B1F"
	&(u16[16]){0x1F2, 0xFD, 0x1F8, 0x108, 0x54, 0x5B, 0x93, 0x5A, 0x7D, 0x212, 0x28, 0x255, 0xB0, 0xA6, 0xB4}, // "大地下道イケブクロ入り口B2F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xB0, 0xA5, 0xB4},									   // "旧警視庁ビルB1F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xA5, 0xB4},											   // "旧警視庁ビル1F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xA6, 0xB4},											   // "旧警視庁ビル2F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xA7, 0xB4},											   // "旧警視庁ビル3F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xA8, 0xB4},											   // "旧警視庁ビル4F"
	&(u16[10]){0x24D, 0x245, 0x24E, 0x24F, 0x92, 0x7B, 0xA9, 0xB4},											   // "旧警視庁ビル5F"
	&(u16[12]){0x66, 0x55, 0x59, 0xA2, 0x55, 0x62, 0x7E, 0x52, 0xA5, 0xB4},									   // "トウキョウタワー1F"
	&(u16[12]){0x66, 0x55, 0x59, 0xA2, 0x55, 0x62, 0x7E, 0x52, 0xA7, 0xA4, 0xB4},							   // "トウキョウタワー30F"
	&(u16[12]){0x66, 0x55, 0x59, 0xA2, 0x55, 0x62, 0x7E, 0x52, 0xA8, 0xA9, 0xB4},							   // "トウキョウタワー45F"
	&(u16[10]){0x83, 0x80, 0x87, 0x254, 0x253, 0x212, 0x28, 0x255},											   // "ギンザ北西入り口"
	&(u16[10]){0x83, 0x80, 0x87, 0x254, 0x256, 0x212, 0x28, 0x255},											   // "ギンザ北東入り口"
	&(u16[10]){0x83, 0x80, 0x87, 0x257, 0x253, 0x212, 0x28, 0x255},											   // "ギンザ南西入り口"
	&(u16[10]){0x83, 0x80, 0x87, 0x257, 0x256, 0x212, 0x28, 0x255},											   // "ギンザ南東入り口"
	&(u16[8]){0x83, 0x80, 0x87, 0xB0, 0xA5, 0xB4},															   // "ギンザB1F"
	&(u16[8]){0x83, 0x80, 0x87, 0xB0, 0xA6, 0xB4},															   // "ギンザB2F"
	&(u16[8]){0x83, 0x80, 0x87, 0xB0, 0xA7, 0xB4},															   // "ギンザB3F"
};
u16 (* D_800A28D0[5])[] = {
    &(u16[12]){0x71, 0x52, 0x58, 0x52, 0x2D, 0x60, 0xA3, 0x66, 0xC, 0x1F, 0xD},                                /* "マーカーをセットします" */
    &(u16[20]){0x71, 0x52, 0x58, 0x52, 0x19, 0x375, 0x383, 0x2D, 0x35F, 0x382, 
        0xC, 0x13, 0x1F8, 0xB, 0x2, 0xCE, 0xCE, 0xCE},                                                         /* "マーカーの？？を？？して下さい．．．" */
    &(u16[12]){0xA, 0x19, 0x71, 0x52, 0x58, 0x52, 0x2D, 0x22D, 0xC, 0x1F, 0xD},                                /* "このマーカーを消します" */
    &(u16[22]){0xF, 0x19, 0x231, 0x25A, 0x16, 0x1A, 0x71, 0x52, 0x58, 0x52, 
        0x2D, 0x60, 0xA3, 0x66, 0x3D, 0x7, 0x1F, 0xE, 0x2E, 0xC9},                                             /* "その場所にはマーカーをセットできません！" */
    &(u16[22]){0xF, 0x19, 0x56, 0x6B, 0x16, 0x1A, 0x71, 0x52, 0x58, 0x52, 
        0x2D, 0x60, 0xA3, 0x66, 0x3D, 0x7, 0x1F, 0xE, 0x2E, 0xC9}                                              /* "そのエノにはマーカーをセットできません！" */
};
u16 (*MarkerNames[5])[] = {
	&(u16[10]){0x2F, 0x2F, 0xBC, 0xBD, 0xC0, 0xBB, 0xAF, 0xBA},												   /* "  NORMAL" */
	&(u16[8]){0x2F, 0x2F, 0xB3, 0xC4, 0xB3, 0xBC, 0xC2},													   /* "  EVENT" */
	&(u16[8]){0x2F, 0x2F, 0xBE, 0xC0, 0xB7, 0xC8, 0xB3},													   /* "  PRIZE" */
	&(u16[8]){0x2F, 0x2F, 0xB0, 0xBD, 0xC1, 0xC1},															   /* "  BOSS" */
	&(u16[8]){0x2F, 0x2F, 0xBD, 0xC2, 0xB6, 0xB3, 0xC0}														   /* "  OTHER" */
};
u16 (*D_800A2950[2])[1] = {
	&(u16[1]){0x2F},																						   /* " " */
	&(u16[1]){0x2F}																							   /* " " */
};
u16 (*D_800A2958[4])[1] = {
	&(u16[1]){0x2F},																						   /* " " */
    &(u16[1]){0x2F},																						   /* " " */
    &(u16[1]){0x2F},																						   /* " " */
	&(u16[1]){0x2F}																							   /* " " */
};
u16 (*MarkerDescriptions[10])[] = {
	&(u16[6]){0x180, 0x181, 0x19, 0x206, 0x40A, 0x16},														   /* "通常の用？に" */
	&(u16[10]){0x54, 0x94, 0x80, 0x66, 0x2D7, 0x316, 0x9A, 0x54, 0x80, 0x66},								   /* "イベント発願ポイント" */
	&(u16[9]){0x1AB, 0x36F, 0x19, 0x30E, 0x3A7, 0x9A, 0x54, 0x80, 0x66},									   /* "宝？の察？ポイント" */
	&(u16[7]){0x95, 0x5F, 0x2F7, 0x2F8, 0x15, 0x3E, 0x16},													   /* "ボス屋犬などに" */
	&(u16[9]){0xF, 0x19, 0x208, 0x1EC, 0x5A0, 0x16, 0x35D, 0x36, 0x13},										   /* "その他状？に？じて" */
	&(u16[5]){0xF2, 0x206, 0xC, 0x1F, 0xD},																	   /* "使用します" */
	&(u16[9]){0x15, 0x3E, 0x16, 0xF2, 0x206, 0xC, 0x1F, 0xD},												   /* "などに使用します" */
	&(u16[9]){0x15, 0x3E, 0x16, 0xF2, 0x206, 0xC, 0x1F, 0xD},												   /* "などに使用します" */
	&(u16[5]){0xF2, 0x206, 0xC, 0x1F, 0xD},																	   /* "使用します" */
	&(u16[5]){0xF2, 0x206, 0xC, 0x1F, 0xD},																	   /* "使用します" */
};
u8 D_800A2C10[12] = {
	11, 0, 7, 8,
	9, 10, 3, 5,
	4, 2, 1, 6};
char * D_800A2C1C[12] = {
	"SHOP",
	"JAKYOU",
	"KAIFUKU",
	"TERMINAL",
	"GAIA",
	"MESIA",
	"RAG'S",
	"( STAIRS",
	") STAIRS",
	"EXIT",
	"ELEVATOR",
	"PLAYER"};
s8 D_800B7438;
struct unk_data_113 * DungeonMap;

extern struct object_ptrs * FirstObjectPtrPtr;

extern void func_8003EDE0();
extern struct object * func_80065EA0();
extern struct object * func_80068510();
extern struct object * func_80065F38();
extern GsOT_TAG * OrderingTable;
